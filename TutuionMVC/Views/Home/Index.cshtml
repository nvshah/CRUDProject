@model  IEnumerable<DataLayer.Student_2>

@{
    ViewBag.Title = "Index";    //Define the title property of View
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <h2 style="align-content:center">Index</h2>

    <p>
        @Html.ActionLink("Create New", "Create", "CRUDApi")
    </p>

    <div class="container">
        <table id="tableStudents" class="table table-striped">
            <tr>
                <th style="display:none">@Html.DisplayNameFor(model => model.Id) </th>
                <th>@Html.DisplayNameFor(model => model.Name)</th>
                <th>@Html.DisplayNameFor(model => model.Standard)</th>
                <th>@Html.DisplayNameFor(model => model.Phone)</th>
                <th>@Html.DisplayNameFor(model => model.Dob)</th>
                <th>@Html.DisplayNameFor(model => model.Medium)</th>
                <th></th>
            </tr>
            @foreach (var student in Model)
            {
                <tr>
                    <td style="display:none" id="input_id">@Html.DisplayFor(model => student.Id)</td>
                    <td id="input_name">@Html.DisplayFor(model => student.Name)</td>
                    <td id="input_standard">@Html.DisplayFor(model => student.Standard)</td>
                    <td id="input_phone">@Html.DisplayFor(model => student.Phone)</td>
                    <td id="input_dob">@Html.DisplayFor(model => student.Dob)</td>
                    <td id="input_medium">@Html.DisplayFor(model => student.Medium)</td>
                    <td>
                        @*<@Html.ActionLink("Edit", "Edit", "CRUDApi",new { _id = student.Id },null) |*@
                        <a class="Edit" href="javascript:;">Edit</a>  |  
                        <a class="Delete" href="javascript:;">Delete</a>
                    </td>
                </tr>
            }
        </table>
    </div>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script type="text/javascript"
            src="http://code.jquery.com/jquery-latest.js">
    </script>

   <script type="text/javascript">

       //Function Added to Post Data To Action via Controller and Redirect To that Page
       $.extend(
           {
               redirectPost: function (location, args) {
                   var form = '';
                   $.each(args, function (key, value) {
                       form += '<input type="hidden" name="' + key + '" value="' + value + '">';
                   });
                   $('<form action="' + location + '" method="POST">' + form + '</form>').appendTo('body').submit();
               }
           });

       //Edit Event Handler
        $("body").on("click", "#tableStudents .Edit", function () {
            var row = $(this).closest("tr");   //$(this) -> current element that clicked

            var values = [];
            $("td", row).each(function () {
                values.push($(this).text());
            });

            //var values = ["10", "dsad", "20", "dsda", "ada", "jsadsa"];
            //alert(values);

            var student = {};
            student.Id = values[0];
            student.Name = values[1];
            student.Standard = values[2];
            student.Phone = values[3];
            student.Dob = values[4];
            student.Medium = values[5];

            //console.log(student);

            $.redirectPost('/CRUDApi/Edit', student);
        });

       //Delete event handler.
       $("body").on("click", "#tableStudents .Delete", function () {
           if (confirm("Do you want to delete this row?")) {
               var row = $(this).closest("tr");

               
               var _Id = row.find("#input_id").text();
               var urlString = "/api/CRUD/Delete/" + _Id
               $.ajax({
                   type: "GET",
                   url: urlString,
                   dataType: "json",
                   success: function (response) {
                       if (response.status == true) {                       
                           row.remove();
                           //setTimeout(function () {// wait for 5 secs(2)
                           //    location.reload(); // then reload the page.(3)
                           //}, 2000);
                       } else {
                           row.find(".Edit").hide();
                           row.find(".Delete").hide();
                           row.find("span").html('&nbsp;');
                       }
                   }
               });
           }
       });

       //Handle Error and display if occurs via inserting
       function handleException(request, message,
           error) {
           var msg = "";
           msg += "Code: " + request.status + "\n";
           msg += "Text: " + request.statusText + "\n";
           if (request.responseJSON != null) {
               msg += "Message" +
                   request.responseJSON.Message + "\n";
           }
           alert(msg);
       }

    </script>
</body>
</html>
