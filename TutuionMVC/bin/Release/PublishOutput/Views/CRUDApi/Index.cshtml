@model IEnumerable<DataLayer.DTOs.StudentDTO>

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <style>
        .tableRecords{
            margin-top:50px;
        }
        
        #txtStd{
            width:150px;
        }

        .input-operation{
           display:flex;
           justify-content:space-between;
        }
        .errorMessage {
            margin-top : 5px;
            color: #999;
            max-height: 200px;
            transition: 0.28s;
            overflow: hidden;
            color: red;
            font-style: italic;
            display:none;
        }       
        /*.input-operation > div:last-child{
            margin-left:auto;
        }*/
        
    </style>
</head>
<body>
    <h2>Index</h2>
     @*<p>
        @Html.ActionLink("Create New", "Create", "CRUDApi")
    </p>*@

    <div class="container">
        <div class="input-operation">
            <div class="input-group" id="txtStd">
                <input type="number" min=1 max=12 class="form-control" placeholder="Standard" name="Standard" />
                <div class="input-group-btn">
                    <button id="stdBtn" class="btn btn-default"><i class="glyphicon glyphicon-check"></i></button>
                </div>
            </div>
            <div>
                <button id="AddRecord" class="btn btn-primary">
                    Add Record
                </button>
            </div>
        </div>
        <p class="errorMessage">
            Enter Std in (1,12)
        </p>
        <div class="tableRecords">
            <table id="tableStudents" class="table table-striped">
                <thead>
                    <tr>
                        <th style="display:none">@Html.DisplayNameFor(model => model.Id) </th>
                        <th>@Html.DisplayNameFor(model => model.Name)</th>
                        <th>@Html.DisplayNameFor(model => model.Standard)</th>
                        <th>@Html.DisplayNameFor(model => model.Phone)</th>
                        <th>@Html.DisplayNameFor(model => model.Dob)</th>
                        <th>@Html.DisplayNameFor(model => model.Medium)</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var student in Model)
                    {
                        <tr>
                            <td style="display:none" id="input_id">@Html.DisplayFor(model => student.Id)</td>
                            <td id="input_name">@Html.DisplayFor(model => student.Name)</td>
                            <td id="input_standard">@Html.DisplayFor(model => student.Standard)</td>
                            <td id="input_phone">@Html.DisplayFor(model => student.Phone)</td>
                            <td id="input_dob">@Html.DisplayFor(model => student.Dob)</td>
                            <td id="input_medium">@Html.DisplayFor(model => student.Medium)</td>
                            <td>
                                @*<@Html.ActionLink("Edit", "Edit", "CRUDApi",new { _id = student.Id },null) |*@
                                <a class="Edit" href="javascript:;">Edit</a>  |
                                <a class="Delete" href="javascript:;">Delete</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script type="text/javascript"
            src="http://code.jquery.com/jquery-latest.js">
    </script>

    <script type="text/javascript">

        //Function Added to Post Data To Action via Controller and Redirect To that Page
        $.extend(
            {
                redirectPost: function (location, args) {
                    var form = '';
                    $.each(args, function (key, value) {
                        form += '<input type="hidden" name="' + key + '" value="' + value + '">';
                    });
                    $('<form action="' + location + '" method="POST">' + form + '</form>').appendTo('body').submit();
                }
            });

        //Edit Event Handler
        $("body").on("click", "#tableStudents .Edit", function () {
            var row = $(this).closest("tr");   //$(this) -> current element that clicked

            var values = [];
            $("td", row).each(function () {
                values.push($(this).text());
            });

            //var values = ["10", "dsad", "20", "dsda", "ada", "jsadsa"];
            //alert(values);

            var student = {};
            student.Id = values[0];
            student.Name = values[1];
            student.Standard = values[2];
            student.Phone = values[3];
            student.Dob = values[4];
            student.Medium = values[5];

            //console.log(student);

            $.redirectPost('/CRUDApi/Edit', student);
        });

        //Delete event handler.
        $("body").on("click", "#tableStudents .Delete", function () {
            if (confirm("Do you want to delete this row?")) {
                var row = $(this).closest("tr");


                var _Id = row.find("#input_id").text();
                var urlString = "/api/CRUD/Delete/" + _Id
                $.ajax({
                    type: "GET",
                    url: urlString,
                    dataType: "json",
                    success: function (response) {
                        if (response.status == true) {
                            row.remove();
                            //setTimeout(function () {// wait for 5 secs(2)
                            //    location.reload(); // then reload the page.(3)
                            //}, 2000);
                        } else {
                            row.find(".Edit").hide();
                            row.find(".Delete").hide();
                            row.find("span").html('&nbsp;');
                        }
                    }
                });
            }
        });

        //Handle Error and display if occurs via inserting
        function handleException(request, message,
            error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
            alert(msg);
        }

        //On Add Button Click
        $('#AddRecord').on('click', function(){
            window.location.href = "/CRUDApi/Create";
        });

        ////On Std Button Click
        //$('#stdBtn').on('click', function () {
        //    var input = $('.input-operation input');

        //    if (input.val()>0 && input.val()<13)
        //    {
        //        input.css('borderColor', '');
        //        $('.errorMessage').css("display", "none");
        //        $('.tableRecords').css("display", "block");
        //    }
        //    else
        //    {
        //        input.css("borderColor", "red");
        //        $('.errorMessage').css("display", "block");
        //        $('.tableRecords').css("display", "none");
        //    }
        //});

    </script>
</body>
</html>
